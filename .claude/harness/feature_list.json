{
  "$schema": "domain-memory-harness-v2",
  "schema_version": "2.0",
  "description": "Backlog for LightwaveOS ESP32-S3 LED control system. Each item is derived from existing project state, not invented.",
  "items": [
    {
      "id": "FIX-TEST-ASSERTIONS",
      "title": "Fix test assertions for current hardware",
      "description": "The existing test file (test/test_main.cpp) asserts NUM_LEDS=81 and palette count=33, but current config uses dual 160-LED strips (320 total). Tests will fail if run. Update test assertions to match current hardware configuration.",
      "acceptance_criteria": [
        "test_led_array_size passes with NUM_LEDS=320",
        "test_palette_count reflects actual palette count",
        "pio test -e native compiles (if applicable) or test file is updated"
      ],
      "verification": [
        "grep -n NUM_LEDS src/config/hardware_config.h",
        "cat test/test_main.cpp"
      ],
      "status": "PASSING",
      "priority": 2,
      "dependencies": [],
      "attempts": [
        {
          "run_id": "worker-004",
          "timestamp": "2025-12-12T08:30:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": ["grep NUM_LEDS", "cat test/test_main.cpp", "pio run -e esp32dev"],
            "results_summary": "Changed LED assertion from 81 to 320. Palette count (33) was already correct. Build passes."
          },
          "commit": "c68b6a4",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Fixed: LED count assertion changed 81â†’320. Palette count was already correct at 33."
    },
    {
      "id": "VERIFY-WIFI-BUILD",
      "title": "Verify WiFi build compiles successfully",
      "description": "The WiFi-enabled environment (esp32dev_wifi) is the primary build for web interface testing per CLAUDE.md. Confirm it builds without errors.",
      "acceptance_criteria": [
        "pio run -e esp32dev_wifi completes with SUCCESS",
        "No compilation errors",
        "Binary size is reasonable (< 80% flash)"
      ],
      "verification": [
        "pio run -e esp32dev_wifi"
      ],
      "status": "PASSING",
      "priority": 1,
      "dependencies": [],
      "attempts": [
        {
          "run_id": "worker-002",
          "timestamp": "2025-12-12T06:45:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": ["pio run -e esp32dev_wifi"],
            "results_summary": "SUCCESS - RAM 19.3%, Flash 31.3% (well under 80% limit). Only deprecation warnings (ArduinoJson API changes), no errors."
          },
          "commit": "53de8f1",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Verified in WORKER run 002. Build takes ~60s cold, ~3s incremental."
    },
    {
      "id": "DOC-BUILD-VERIFICATION",
      "title": "Document canonical verification sequence",
      "description": "Create init.sh that runs the project's fast verification. Currently no single command runs all checks. Need to identify: format, lint, build, test.",
      "acceptance_criteria": [
        "init.sh exists and is executable",
        "Running ./init.sh returns 0 on healthy repo",
        "Script prints clear pass/fail status"
      ],
      "verification": [
        "./init.sh"
      ],
      "status": "PASSING",
      "priority": 1,
      "dependencies": [],
      "attempts": [
        {
          "run_id": "init-001",
          "timestamp": "2025-12-12T06:38:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": ["./init.sh"],
            "results_summary": "init.sh created, executable, returns 0, prints PASS/FAIL summary with colors"
          },
          "commit": "4860021",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Created in INITIALIZER run 001. Checks: toolchain detection, git status, esp32dev build."
    },
    {
      "id": "CENTER-ORIGIN-AUDIT",
      "title": "Audit effects for CENTER ORIGIN compliance",
      "description": "Per CLAUDE.md, ALL effects must originate from LED 79/80 (center). TODO.md mentions 'Fix center-origin compliance in some LGP effects'. Need to identify and fix non-compliant effects.",
      "acceptance_criteria": [
        "All effects in src/effects/strip/ verified for center-origin pattern",
        "Non-compliant effects identified and listed",
        "At least one non-compliant effect fixed as proof of concept"
      ],
      "verification": [
        "grep -rn 'for.*i = 0' src/effects/strip/ | head -20",
        "grep -rn 'center\\|CENTER\\|79\\|80' src/effects/strip/"
      ],
      "status": "PASSING",
      "priority": 3,
      "dependencies": [],
      "attempts": [
        {
          "run_id": "worker-006",
          "timestamp": "2025-12-12T08:25:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": [
              "grep -rn 'for.*i = 0' src/effects/strip/*.cpp",
              "grep -rn 'distFromCenter|CENTER_POINT' src/effects/strip/*.cpp"
            ],
            "results_summary": "Audited all effect files. Found 1 non-compliant effect (plasma() in StripEffects.cpp) - was using linear position instead of distFromCenter. Fixed by converting to center-origin pattern. All other effects already compliant."
          },
          "commit": "2c31cdd",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Fixed: plasma() effect converted to CENTER ORIGIN. All effects now use distFromCenter pattern."
    },
    {
      "id": "HEAP-FRAG-MONITOR",
      "title": "Implement heap fragmentation monitoring",
      "description": "TODO.md lists 'Heap fragmentation monitoring improvements' as known issue. FEATURE_MEMORY_DEBUG is enabled. Need to verify monitoring works or improve it.",
      "acceptance_criteria": [
        "Serial output shows heap stats during operation",
        "Fragmentation percentage is logged",
        "Alert threshold for high fragmentation exists"
      ],
      "verification": [
        "grep -rn 'heap\\|fragment' src/"
      ],
      "status": "PASSING",
      "priority": 4,
      "dependencies": ["VERIFY-WIFI-BUILD"],
      "attempts": [
        {
          "run_id": "worker-006",
          "timestamp": "2025-12-12T08:30:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": [
              "grep -rn 'heap|fragment' src/",
              "pio run -e esp32dev"
            ],
            "results_summary": "Heap monitoring already existed in PerformanceMonitor.h. Enhanced with: (1) Added fragmentation to printCompactStatus(), (2) Added FRAGMENTATION_WARNING_THRESHOLD (30%) and FRAGMENTATION_CRITICAL_THRESHOLD (50%), (3) Added [WARN]/[CRITICAL] alerts, (4) Added isFragmentationWarning()/isFragmentationCritical() query methods."
          },
          "commit": "2c31cdd",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Enhanced PerformanceMonitor with fragmentation thresholds and alerts."
    },
    {
      "id": "CLEAN-GIT-STATE",
      "title": "Clean up uncommitted changes on feature branch",
      "description": "Git status shows many modified and deleted files on feature/zone-composer branch. The branch has uncommitted work including deleted LightwaveOS-Production directory. Need to commit or stash before harness work.",
      "acceptance_criteria": [
        "git status shows clean working tree (or intentional ignored files only)",
        "Feature branch changes are committed with descriptive message"
      ],
      "verification": [
        "git status --porcelain | wc -l"
      ],
      "status": "PASSING",
      "priority": 2,
      "dependencies": [],
      "attempts": [
        {
          "run_id": "worker-006",
          "timestamp": "2025-12-12T08:20:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": ["git status --porcelain | wc -l"],
            "results_summary": "Created 2 commits: (1) Removed deprecated LightwaveOS-Production (95 files), (2) Zone-composer feature with web interface (49 files). Updated .gitignore for dev artifacts. git status now shows 0 uncommitted changes."
          },
          "commit": "3e904c0",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Cleaned. Two commits: 7df70d8 (remove deprecated), 3e904c0 (zone-composer feature)."
    },
    {
      "id": "HARNESS-ENHANCE",
      "title": "Enhance domain memory harness with full protocols",
      "description": "Implement the complete domain memory harness with mutation protocols, validation rules, extracted reference files, and optional Python helper.",
      "acceptance_criteria": [
        "HARNESS_RULES.md documents all mutation protocols",
        "feature_list.json uses v2 schema with attempts[]",
        "ARCHITECTURE.md contains extracted key facts",
        "CONSTRAINTS.md contains extracted hard limits",
        "agent-progress.md has Lessons Learned section"
      ],
      "verification": [
        "cat HARNESS_RULES.md | head -50",
        "cat feature_list.json | grep schema_version",
        "test -f ARCHITECTURE.md && echo exists",
        "test -f CONSTRAINTS.md && echo exists"
      ],
      "status": "PASSING",
      "priority": 1,
      "dependencies": [],
      "attempts": [
        {
          "run_id": "worker-003",
          "timestamp": "2025-12-12T07:55:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": [
              "ls -la HARNESS_RULES.md ARCHITECTURE.md CONSTRAINTS.md",
              "cat feature_list.json | grep schema_version"
            ],
            "results_summary": "Phase 0-2 complete: HARNESS_RULES.md (300+ lines), feature_list.json v2 schema, ARCHITECTURE.md, CONSTRAINTS.md, Lessons Learned section. Phases 3-4 (harness.py, concurrency) optional."
          },
          "commit": "5da7912",
          "reverted": false
        },
        {
          "run_id": "worker-005",
          "timestamp": "2025-12-12T08:12:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": [
              "python3 harness.py --help",
              "python3 harness.py validate",
              "python3 harness.py status",
              "python3 harness.py next",
              "python3 harness.py lock worker-005 TEST",
              "python3 harness.py unlock"
            ],
            "results_summary": "Phase 3-4 complete: harness.py (~350 lines) with CLI+library interface, validation, next item selection, concurrency lock. All commands tested and working."
          },
          "commit": "ca458b9",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Complete. All phases implemented: Phase 0-2 (docs), Phase 3 (harness.py), Phase 4 (concurrency lock)."
    },
    {
      "id": "PERF-TRIG-LOOKUP",
      "title": "Add fast trig lookup tables for effects",
      "description": "Add 256-entry sine/cosine lookup tables to reduce CPU cycles in heavy-math effects. Provides sin8_fast(), cos8_fast(), sinf_fast(), cosf_fast() functions.",
      "acceptance_criteria": [
        "TrigLookup.h and TrigLookup.cpp exist in src/utils/",
        "Lookup tables provide uint8_t, int8_t, and float versions",
        "Build compiles successfully",
        "Available for future effect optimization"
      ],
      "verification": [
        "test -f src/utils/TrigLookup.h && echo exists",
        "pio run -e esp32dev_wifi"
      ],
      "status": "PASSING",
      "priority": 1,
      "dependencies": [],
      "attempts": [
        {
          "run_id": "worker-007",
          "timestamp": "2025-12-12T10:30:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": ["pio run -e esp32dev_wifi"],
            "results_summary": "Created TrigLookup.h (150 lines) and TrigLookup.cpp (100 lines) with 256-entry sine tables. Provides sin8_fast, cos8_fast, sinf_fast, cosf_fast, plus conversion utilities. Build passes - RAM 19.3%, Flash 31.3%."
          },
          "commit": "d58849e",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "Multi-core optimization deferred - lookup tables provide sufficient performance boost with lower risk."
    },
    {
      "id": "OTA-UPDATES",
      "title": "Implement OTA (Over-The-Air) firmware updates",
      "description": "Add ability to flash new firmware over WiFi without USB connection. Use ESP32 ArduinoOTA or AsyncElegantOTA library. Include web interface for upload.",
      "acceptance_criteria": [
        "OTA upload works via web interface",
        "Progress indicator during upload",
        "Automatic reboot after successful flash",
        "Rollback protection (don't brick on bad upload)"
      ],
      "verification": [
        "grep -rn 'OTA\\|Update' src/",
        "curl -X POST http://lightwaveos.local/update"
      ],
      "status": "PASSING",
      "priority": 2,
      "dependencies": ["VERIFY-WIFI-BUILD"],
      "attempts": [
        {
          "run_id": "worker-007",
          "timestamp": "2025-12-12T10:25:00Z",
          "result": "PASSED",
          "evidence": {
            "commands_run": ["pio run -e esp32dev_wifi"],
            "results_summary": "OTA endpoint already existed at /update in WebServer.cpp. Enabled FEATURE_OTA_UPDATE flag. Added Firmware Update card to web UI with file picker, progress bar, status messages. Dual-slot partition table supports rollback. Build passes."
          },
          "commit": "d58849e",
          "reverted": false
        }
      ],
      "override_reason": null,
      "notes": "OTA endpoint existed, just needed UI. Web interface now has full upload capability with progress indicator."
    }
  ]
}
