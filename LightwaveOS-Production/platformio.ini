; PlatformIO Configuration for LightwaveOS Production Build
; CRITICAL: Real-time performance requirements
; - NO PSRAM usage (80+ cycle latency kills performance)  
; - Internal SRAM only (327,680 bytes)
; - 16MB Flash for code/data storage
; - Custom partition table required

[platformio]
default_envs = esp32-s3-16mb

[env:esp32-s3-16mb]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Override board manifest for 16MB flash
board_build.flash_size = 16MB
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216

; CRITICAL: NO PSRAM! 
; Do NOT add PSRAM flags - it destroys real-time performance
board_build.psram_type = 
board_build.arduino.memory_type = qio_qspi

; Use custom partition table - NO OTA WASTE
board_build.partitions = partitions_16MB_no_ota.csv

; Serial configuration - UPDATE TO YOUR PORT
monitor_speed = 115200
upload_speed = 921600
upload_port = /dev/cu.usbmodem1401
monitor_port = /dev/cu.usbmodem1401

; Build flags matching Arduino CLI behavior
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    ; CRITICAL: NO -DBOARD_HAS_PSRAM flag!
    ; Memory allocation must use internal SRAM only
    -DNO_GLOBAL_INSTANCES
    -DDISABLE_ALL_LIBRARY_WARNINGS
    ; Allow narrowing conversions for FixedPoint types
    -Wno-narrowing

; Library dependencies
lib_deps = 
    fastled/FastLED@^3.6.0
    bblanchon/ArduinoJson@^6.21.3
    pharap/FixedPoints@^1.1.1

; Ensure LittleFS is properly configured
board_build.filesystem = littlefs