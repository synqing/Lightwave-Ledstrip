<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K1-Lightwave Controller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Geist', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'],
                    },
                    colors: {
                        canvas: '#1c2130',
                        surface: '#252d3f',
                        elevated: '#2f3849',
                        text: {
                            primary: '#e6e9ef',
                            secondary: '#b5bdca',
                            tertiary: '#8b92a0',
                        },
                        accent: {
                            cyan: '#00d4ff',
                            zone1: '#6ee7f3',
                            zone2: '#22dd88',
                            zone3: '#ffb84d',
                        },
                        border: {
                            subtle: '#3a4254',
                            interactive: '#4a5568',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.4s ease-in-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-canvas text-text-primary flex flex-col min-h-screen selection:bg-accent-cyan selection:text-canvas">

    <!-- Top Status Bar -->
    <header class="sticky top-0 z-50 bg-canvas/80 backdrop-blur-md border-b border-border-subtle h-12 flex items-center justify-between px-6">
        <div class="flex items-center gap-6 text-xs text-text-secondary">
            <div class="flex items-center gap-2">
                <span class="iconify text-text-tertiary" data-icon="solar:graph-up-bold-duotone"></span>
                <span>FPS: <span id="status-fps" class="font-semibold text-text-primary">--</span></span>
            </div>
            <div class="flex items-center gap-2">
                <span class="iconify text-text-tertiary" data-icon="solar:cpu-bolt-bold-duotone"></span>
                <span>MEM: <span id="status-mem" class="font-semibold text-text-primary">--</span></span>
            </div>
            <div class="flex items-center gap-2">
                <span class="iconify text-text-tertiary" data-icon="solar:music-library-2-bold-duotone"></span>
                <span>FX: <span id="status-fx" class="font-semibold text-text-primary">--</span></span>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <span id="status-text" class="text-xs font-semibold tracking-wide text-text-secondary">OFFLINE</span>
            <div id="status-dot" class="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(255,85,85,0.6)]"></div>
        </div>
    </header>

    <main class="flex-1 flex flex-col items-center w-full px-4 py-8 md:px-8 pb-24 overflow-x-hidden">

        <!-- Header -->
        <h1 class="text-2xl font-semibold tracking-tight mb-8 text-center text-white">K1-Lightwave</h1>

        <!-- Hero Visualization -->
        <div class="w-full max-w-[60rem] aspect-[32/6] bg-black rounded-[28px] border border-white/5 shadow-[0_0_4rem_rgba(0,0,0,0.9)] relative overflow-hidden flex items-center justify-center mb-12 opacity-0 animate-fade-in" style="animation-delay: 100ms;">

            <!-- Flex container representing the LED strip structure -->
            <div class="flex w-full h-full">
                <!-- Segments defined by percentage widths -->

                <!-- Zone 3 Left (12.5%) -->
                <div class="relative h-full w-[12.5%] border-r border-white/5 flex items-center justify-center">
                    <div id="vis-z3-l" class="zone-overlay absolute inset-0 bg-accent-zone3 transition-opacity duration-300 opacity-0 mix-blend-screen"></div>
                </div>

                <!-- Zone 2 Left (28.125%) -->
                <div class="relative h-full w-[28.125%] border-r border-white/5 flex items-center justify-center">
                    <div id="vis-z2-l" class="zone-overlay absolute inset-0 bg-accent-zone2 transition-opacity duration-300 opacity-0 mix-blend-screen"></div>
                </div>

                <!-- Zone 1 Center (18.75%) - Default Active -->
                <div class="relative h-full w-[18.75%] border-r border-white/5 flex items-center justify-center">
                    <div id="vis-z1" class="zone-overlay absolute inset-0 bg-accent-zone1 transition-opacity duration-300 opacity-50 mix-blend-screen shadow-[0_0_30px_rgba(110,231,243,0.3)]"></div>
                    <!-- Center Marker -->
                    <div class="absolute top-0 bottom-0 left-1/2 w-px bg-white/20 z-10"></div>
                </div>

                <!-- Zone 2 Right (28.125%) -->
                <div class="relative h-full w-[28.125%] border-r border-white/5 flex items-center justify-center">
                    <div id="vis-z2-r" class="zone-overlay absolute inset-0 bg-accent-zone2 transition-opacity duration-300 opacity-0 mix-blend-screen"></div>
                </div>

                <!-- Zone 3 Right (12.5%) -->
                <div class="relative h-full w-[12.5%] flex items-center justify-center">
                    <div id="vis-z3-r" class="zone-overlay absolute inset-0 bg-accent-zone3 transition-opacity duration-300 opacity-0 mix-blend-screen"></div>
                </div>
            </div>

            <!-- Cosmetic Gloss -->
            <div class="absolute inset-0 bg-gradient-to-b from-white/5 to-transparent pointer-events-none rounded-[28px]"></div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full max-w-[80rem]">

            <!-- Zone Composer Card -->
            <div class="bg-surface border border-border-subtle rounded-xl p-6 flex flex-col gap-4 opacity-0 animate-fade-in" style="animation-delay: 200ms;">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="iconify text-accent-cyan" data-icon="solar:layers-minimalistic-bold-duotone" data-width="20"></span>
                        <h2 class="text-lg font-semibold tracking-tight text-white">Zone Composer</h2>
                    </div>
                    <!-- Zone Count Selector -->
                    <div class="flex bg-elevated rounded-lg p-0.5">
                        <button onclick="setZoneCount(1)" class="w-6 h-6 text-xs text-text-secondary hover:text-white rounded transition-colors">1</button>
                        <button onclick="setZoneCount(2)" class="w-6 h-6 text-xs text-text-secondary hover:text-white rounded transition-colors">2</button>
                        <button onclick="setZoneCount(3)" id="zone-count-3" class="w-6 h-6 text-xs text-black bg-accent-cyan font-semibold rounded shadow-sm">3</button>
                        <button onclick="setZoneCount(4)" class="w-6 h-6 text-xs text-text-secondary hover:text-white rounded transition-colors">4</button>
                    </div>
                </div>

                <!-- Zone Tabs -->
                <div class="flex border-b border-border-subtle mt-2" role="tablist">
                    <button onclick="selectZone(3)" id="tab-z3" class="flex-1 pb-2 text-sm text-text-secondary hover:text-text-primary transition-colors flex justify-center items-center gap-2 border-b-2 border-transparent" role="tab" aria-selected="false">
                        <span class="w-2 h-2 rounded-full bg-accent-zone3"></span>
                        Zone 3
                    </button>
                    <button onclick="selectZone(2)" id="tab-z2" class="flex-1 pb-2 text-sm text-text-secondary hover:text-text-primary transition-colors flex justify-center items-center gap-2 border-b-2 border-transparent" role="tab" aria-selected="false">
                        <span class="w-2 h-2 rounded-full bg-accent-zone2"></span>
                        Zone 2
                    </button>
                    <button onclick="selectZone(1)" id="tab-z1" class="flex-1 pb-2 text-sm font-semibold text-text-primary flex justify-center items-center gap-2 border-b-2 border-accent-cyan" role="tab" aria-selected="true">
                        <span class="w-2 h-2 rounded-full bg-accent-zone1"></span>
                        Zone 1
                    </button>
                </div>

                <!-- LED Range Badge -->
                <div id="range-badge" class="w-full py-2 px-3 rounded text-xs font-mono font-medium text-center border bg-accent-zone1/10 text-accent-zone1 border-accent-zone1/20 transition-all duration-300">
                    LEDs 65-94
                </div>

                <!-- Effect Selection -->
                <div class="flex gap-2 items-center">
                    <button onclick="prevEffect()" class="w-10 h-10 flex items-center justify-center rounded-lg bg-elevated border border-border-interactive text-text-secondary hover:bg-surface hover:text-white transition-colors">
                        <span class="iconify" data-icon="solar:arrow-left-bold-duotone"></span>
                    </button>
                    <div class="relative flex-1">
                        <select id="effect-select" onchange="setZoneEffect()" class="w-full appearance-none bg-elevated border border-border-interactive text-text-primary rounded-lg pl-3 pr-10 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all">
                            <optgroup label="Classic">
                                <option value="0">Plasma Flow</option>
                                <option value="1">Fire Embers</option>
                                <option value="2">Deep Water</option>
                            </optgroup>
                            <optgroup label="Advanced">
                                <option value="3">Aurora Borealis</option>
                                <option value="4">Audio React</option>
                            </optgroup>
                        </select>
                        <div class="absolute right-3 top-3 pointer-events-none text-text-secondary">
                            <span class="iconify" data-icon="solar:alt-arrow-down-bold-duotone"></span>
                        </div>
                    </div>
                    <button onclick="nextEffect()" class="w-10 h-10 flex items-center justify-center rounded-lg bg-elevated border border-border-interactive text-text-secondary hover:bg-surface hover:text-white transition-colors">
                        <span class="iconify" data-icon="solar:arrow-right-bold-duotone"></span>
                    </button>
                </div>

                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="enableZone()" class="py-2.5 rounded-lg bg-accent-cyan text-black text-sm font-semibold hover:opacity-90 transition-opacity">
                        Enable
                    </button>
                    <button onclick="disableZone()" class="py-2.5 rounded-lg bg-elevated border border-border-interactive text-text-secondary text-sm font-medium hover:bg-surface hover:text-text-primary transition-colors">
                        Disable
                    </button>
                </div>

                <!-- Edit Range Collapsible -->
                <div class="border-t border-border-subtle pt-2">
                    <button onclick="toggleEditRange()" class="flex items-center gap-2 text-xs font-medium text-text-secondary hover:text-text-primary transition-colors py-2">
                        <span class="iconify" data-icon="solar:settings-bold-duotone"></span>
                        Edit Range
                    </button>

                    <div id="edit-range-panel" class="max-h-0 overflow-hidden transition-all duration-300 ease-in-out opacity-0">
                        <div class="pt-2 pb-1 flex flex-col gap-3">
                            <!-- Toggle Pills -->
                            <div class="flex p-1 bg-canvas rounded-lg self-start">
                                <button class="px-3 py-1 rounded-md text-xs font-medium bg-elevated text-text-primary shadow-sm">Start-End</button>
                                <button class="px-3 py-1 rounded-md text-xs font-medium text-text-tertiary hover:text-text-secondary">Count</button>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div class="flex flex-col gap-1">
                                    <label class="text-[10px] uppercase tracking-wider text-text-tertiary">Left Start</label>
                                    <input type="number" value="65" class="bg-elevated border border-border-interactive rounded-lg px-3 py-1.5 text-sm text-text-primary focus:ring-2 focus:ring-accent-cyan focus:outline-none">
                                </div>
                                <div class="flex flex-col gap-1">
                                    <label class="text-[10px] uppercase tracking-wider text-text-tertiary">Left End</label>
                                    <input type="number" value="79" class="bg-elevated border border-border-interactive rounded-lg px-3 py-1.5 text-sm text-text-primary focus:ring-2 focus:ring-accent-cyan focus:outline-none">
                                </div>
                            </div>

                            <div class="text-xs font-mono text-accent-cyan/80 bg-canvas/50 p-2 rounded border border-white/5">
                                Right Segment (Auto): 80-94
                            </div>

                            <!-- Validation Error (Hidden by default) -->
                            <div id="range-error" class="hidden bg-red-500/10 border-l-4 border-red-500 p-2 text-xs text-red-200 flex items-center gap-2">
                                <span class="iconify" data-icon="solar:danger-triangle-bold-duotone"></span>
                                <span id="range-error-text">Zone overlaps with Zone 2</span>
                            </div>

                            <div class="flex justify-end gap-2 mt-2">
                                <button onclick="toggleEditRange()" class="px-3 py-1.5 rounded-lg text-xs font-medium text-text-secondary bg-elevated border border-border-interactive hover:bg-surface">Cancel</button>
                                <button class="px-3 py-1.5 rounded-lg text-xs font-semibold text-black bg-accent-cyan hover:opacity-90">Save</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="border-t border-border-subtle pt-4 mt-auto">
                    <button class="w-full text-xs text-text-tertiary hover:text-text-secondary transition-colors text-center">Reset to Defaults (3 Zones)</button>
                </div>
            </div>

            <!-- Global Parameters Card -->
            <div class="bg-surface border border-border-subtle rounded-xl p-6 flex flex-col gap-6 opacity-0 animate-fade-in" style="animation-delay: 300ms;">
                <div class="flex items-center gap-2">
                    <span class="iconify text-accent-cyan" data-icon="solar:tuning-bold-duotone" data-width="20"></span>
                    <h2 class="text-lg font-semibold tracking-tight text-white">Global Parameters</h2>
                </div>

                <!-- Sliders -->
                <div class="space-y-6">
                    <!-- Brightness -->
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between items-end">
                            <label class="text-sm font-medium text-text-secondary">Brightness</label>
                            <span class="font-mono text-xs font-semibold text-accent-cyan" id="val-brightness">210</span>
                        </div>
                        <input type="range" min="0" max="255" value="210" class="slider-input" id="slider-brightness" oninput="updateSlider(this, 'val-brightness')">
                    </div>

                    <!-- Speed -->
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between items-end">
                            <label class="text-sm font-medium text-text-secondary">Speed</label>
                            <span class="font-mono text-xs font-semibold text-accent-cyan" id="val-speed">32</span>
                        </div>
                        <input type="range" min="1" max="50" value="32" class="slider-input" id="slider-speed" oninput="updateSlider(this, 'val-speed')">
                    </div>
                </div>

                <!-- Palette -->
                <div class="flex flex-col gap-2">
                    <label class="text-sm font-medium text-text-secondary">Color Palette</label>
                    <div class="relative">
                        <select id="palette-select" onchange="setPalette()" class="w-full appearance-none bg-elevated border border-border-interactive text-text-primary rounded-lg pl-3 pr-10 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-accent-cyan transition-all">
                            <option value="0">Palette 0 (Synthwave)</option>
                            <option value="1">Palette 1 (Cyberpunk)</option>
                            <option value="2">Palette 2 (Nature)</option>
                            <option value="3">Palette 3 (Monochrome)</option>
                        </select>
                        <div class="absolute right-3 top-3 pointer-events-none text-text-secondary">
                            <span class="iconify" data-icon="solar:alt-arrow-down-bold-duotone"></span>
                        </div>
                    </div>
                </div>

                <!-- Random Transitions -->
                <div class="flex items-center justify-between pt-2">
                    <label class="text-sm font-medium text-text-secondary">Random Transitions</label>
                    <div class="relative inline-block w-12 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="toggle-transitions" onchange="toggleTransitions()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-elevated appearance-none cursor-pointer transition-all duration-200 left-0">
                        <label for="toggle-transitions" class="toggle-label block overflow-hidden h-6 rounded-full bg-elevated cursor-pointer transition-colors duration-200"></label>
                    </div>
                </div>
            </div>

            <!-- Visual Pipeline Card (Collapsed) -->
            <div class="col-span-1 md:col-span-2 lg:col-span-1 bg-surface border border-border-subtle rounded-xl overflow-hidden opacity-0 animate-fade-in" style="animation-delay: 400ms;">
                <button onclick="togglePipeline()" class="w-full p-6 flex items-center justify-between hover:bg-elevated/50 transition-colors text-left">
                    <div class="flex items-center gap-2">
                        <span class="iconify text-accent-cyan" data-icon="solar:graph-new-bold-duotone" data-width="20"></span>
                        <h2 class="text-lg font-semibold tracking-tight text-white">Visual Pipeline</h2>
                    </div>
                    <span class="iconify text-text-secondary transition-transform duration-300 transform" id="pipeline-chevron" data-icon="solar:alt-arrow-down-bold-duotone"></span>
                </button>

                <div id="pipeline-content" class="max-h-0 overflow-hidden transition-all duration-300 ease-in-out px-6">
                    <div class="pb-6 space-y-5 pt-2">
                        <!-- Intensity -->
                        <div class="flex flex-col gap-2">
                            <div class="flex justify-between items-end">
                                <label class="text-xs font-medium text-text-secondary">Intensity</label>
                                <span class="font-mono text-[10px] font-semibold text-accent-cyan" id="val-int">128</span>
                            </div>
                            <input type="range" min="0" max="255" value="128" class="slider-input" id="slider-intensity" oninput="updateSlider(this, 'val-int')">
                        </div>
                         <!-- Saturation -->
                         <div class="flex flex-col gap-2">
                            <div class="flex justify-between items-end">
                                <label class="text-xs font-medium text-text-secondary">Saturation</label>
                                <span class="font-mono text-[10px] font-semibold text-accent-cyan" id="val-sat">200</span>
                            </div>
                            <input type="range" min="0" max="255" value="200" class="slider-input" id="slider-saturation" oninput="updateSlider(this, 'val-sat')">
                        </div>
                         <!-- Complexity -->
                         <div class="flex flex-col gap-2">
                            <div class="flex justify-between items-end">
                                <label class="text-xs font-medium text-text-secondary">Complexity</label>
                                <span class="font-mono text-[10px] font-semibold text-accent-cyan" id="val-com">45</span>
                            </div>
                            <input type="range" min="0" max="255" value="45" class="slider-input" id="slider-complexity" oninput="updateSlider(this, 'val-com')">
                        </div>
                         <!-- Variation -->
                         <div class="flex flex-col gap-2">
                            <div class="flex justify-between items-end">
                                <label class="text-xs font-medium text-text-secondary">Variation</label>
                                <span class="font-mono text-[10px] font-semibold text-accent-cyan" id="val-var">180</span>
                            </div>
                            <input type="range" min="0" max="255" value="180" class="slider-input" id="slider-variation" oninput="updateSlider(this, 'val-var')">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Sticky Preset Bar -->
    <footer class="fixed bottom-0 left-0 right-0 z-40 bg-surface/90 backdrop-blur border-t border-border-subtle p-4">
        <div class="max-w-[80rem] mx-auto flex items-center justify-between gap-4">
            <div class="flex gap-2 overflow-x-auto pb-1 no-scrollbar">
                <button onclick="loadPreset(0)" class="px-4 py-2 rounded-lg bg-elevated border border-border-interactive text-xs font-medium text-text-secondary hover:text-text-primary hover:border-accent-cyan/50 hover:bg-surface transition-all whitespace-nowrap">Preset 0</button>
                <button onclick="loadPreset(1)" class="px-4 py-2 rounded-lg bg-elevated border border-border-interactive text-xs font-medium text-text-secondary hover:text-text-primary hover:border-accent-cyan/50 hover:bg-surface transition-all whitespace-nowrap">Preset 1</button>
                <button onclick="loadPreset(2)" class="px-4 py-2 rounded-lg bg-elevated border border-border-interactive text-xs font-medium text-text-secondary hover:text-text-primary hover:border-accent-cyan/50 hover:bg-surface transition-all whitespace-nowrap">Preset 2</button>
                <button onclick="loadPreset(3)" class="px-4 py-2 rounded-lg bg-elevated border border-border-interactive text-xs font-medium text-text-secondary hover:text-text-primary hover:border-accent-cyan/50 hover:bg-surface transition-all whitespace-nowrap">Preset 3</button>
                <button onclick="loadPreset(4)" class="px-4 py-2 rounded-lg bg-elevated border border-border-interactive text-xs font-medium text-text-secondary hover:text-text-primary hover:border-accent-cyan/50 hover:bg-surface transition-all whitespace-nowrap">Preset 4</button>
            </div>

            <button onclick="savePreset()" class="flex items-center gap-2 px-5 py-2 rounded-lg bg-accent-cyan text-black text-sm font-semibold hover:opacity-90 transition-opacity whitespace-nowrap">
                <span class="iconify" data-icon="solar:diskette-bold-duotone"></span>
                Save
            </button>
        </div>
    </footer>

    <script src="app.js"></script>

</body>
</html>
