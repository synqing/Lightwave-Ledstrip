<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LightwaveOS</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

    <style>
        :root {
            /* V3 Design Tokens */
            --gold: #FFB84D;
            --gold-dim: rgba(255, 184, 77, 0.3);
            --gold-glow: rgba(255, 184, 77, 0.15);

            --bg-base: #000000;
            --bg-surface: #111111;
            --bg-overlay: #1A1A1A;
            --bg-elevated: #222222;

            --text-primary: #F2F2F2;
            --text-secondary: #888888;
            --text-muted: #444444;

            --success: #4DFFB8;
            --error: #FF4D4D;
            --info: #4D88FF;

            /* V2 Zone Colors (EXACT) */
            --zone-1-color: #6ee7f3;
            --zone-2-color: #22dd88;
            --zone-3-color: #ffb84d;

            --accent-primary: #00d4ff;
            --accent-primary-glow: rgba(0, 212, 255, 0.25);

            --font-display: 'Space Grotesk', system-ui, sans-serif;
            --font-body: 'Inter', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-base);
            color: var(--text-primary);
            font-family: var(--font-body);
            -webkit-font-smoothing: antialiased;
            margin: 0;
            min-height: 100vh;
        }

        .font-display { font-family: var(--font-display); }
        .font-mono { font-family: var(--font-mono); }
        .tabular-nums { font-variant-numeric: tabular-nums; }

        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--bg-elevated); border-radius: 2px; }

        :focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }

        /* V2 Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            height: 32px;
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: var(--text-primary);
            margin-top: -6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        }

        .slider-input {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-elevated);
            outline: none;
        }
        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
        }

        .card {
            background: var(--bg-surface);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-family: var(--font-display);
            position: relative;
        }
        .nav-item:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }
        .nav-item.active {
            background: var(--gold-glow);
            color: var(--gold);
        }
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 2px;
            height: 60%;
            background: var(--gold);
            border-radius: 0 2px 2px 0;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.6875rem;
            font-family: var(--font-display);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            cursor: pointer;
            transition: all 0.15s ease;
            border: 1px solid transparent;
        }
        .chip.active {
            background: var(--gold);
            color: black;
        }
        .chip:not(.active) {
            color: var(--text-secondary);
            border-color: rgba(255,255,255,0.08);
        }
        .chip:not(.active):hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .effect-item {
            padding: 0.875rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.15s ease;
            border-left: 2px solid transparent;
        }
        .effect-item:hover { background: var(--bg-elevated); }
        .effect-item.active {
            background: var(--gold-glow);
            border-left-color: var(--gold);
        }

        .palette-swatch {
            height: 40px;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.15s ease;
            border: 2px solid transparent;
        }
        .palette-swatch:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        .palette-swatch.selected {
            border-color: var(--gold);
            box-shadow: 0 0 0 2px var(--gold-dim);
        }

        .transition-card {
            padding: 1rem;
            border-radius: 0.75rem;
            background: var(--bg-elevated);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        .transition-card:hover {
            border-color: rgba(255,255,255,0.1);
        }
        .transition-card.selected {
            border-color: var(--gold);
            background: var(--gold-glow);
        }

        .stat-gauge {
            position: relative;
            width: 80px;
            height: 80px;
        }
        .stat-gauge svg { transform: rotate(-90deg); }
        .stat-gauge .value {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--bg-elevated);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .toggle.active { background: var(--gold); }
        .toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }
        .toggle.active::after { transform: translateX(20px); }

        .preset-btn {
            width: 44px;
            height: 44px;
            border-radius: 0.5rem;
            background: var(--bg-surface);
            border: 1px solid rgba(255,255,255,0.05);
            font-family: var(--font-mono);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .preset-btn:hover {
            border-color: var(--gold-dim);
            color: var(--text-primary);
        }
        .preset-btn.active {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--bg-base);
            box-shadow: 0 0 20px var(--gold-dim);
        }

        .glow-gold { box-shadow: 0 0 60px var(--gold-glow); }
    </style>
</head>
<body>
    <div class="flex min-h-screen">

        <!-- LEFT SIDEBAR (V3 Style) -->
        <aside class="w-56 flex-shrink-0 border-r border-white/5 flex flex-col" style="background: linear-gradient(180deg, #0a0a0a 0%, #000 100%);">

            <div class="p-5 border-b border-white/5">
                <div class="font-display text-sm tracking-[0.16em] uppercase">
                    <span style="color: var(--gold);">K</span><span style="color: var(--text-muted);">-</span><span style="color: var(--text-primary);">1</span>
                </div>
                <div class="text-[10px] tracking-[0.12em] uppercase" style="color: var(--text-muted); margin-top: 4px;">Lightwave OS</div>
            </div>

            <div class="px-5 py-3 border-b border-white/5">
                <div class="flex items-center gap-2">
                    <span id="status-dot" class="w-1.5 h-1.5 rounded-full bg-red-500"></span>
                    <span id="status-text" class="text-xs" style="color: var(--text-secondary);">Offline</span>
                </div>
                <div class="text-[10px] font-mono" style="color: var(--text-muted); margin-top: 2px;">192.168.1.42</div>
            </div>

            <nav class="flex-1 p-3 space-y-1">
                <div class="nav-item active" data-tab="composer">
                    <span class="iconify" data-icon="lucide:sliders-horizontal" data-width="16"></span>
                    <span>Composer</span>
                </div>
                <div class="nav-item" data-tab="effects">
                    <span class="iconify" data-icon="lucide:sparkles" data-width="16"></span>
                    <span>Effects</span>
                </div>
                <div class="nav-item" data-tab="palettes">
                    <span class="iconify" data-icon="lucide:palette" data-width="16"></span>
                    <span>Palettes</span>
                </div>
                <div class="nav-item" data-tab="transitions">
                    <span class="iconify" data-icon="lucide:shuffle" data-width="16"></span>
                    <span>Transitions</span>
                </div>
                <div class="nav-item" data-tab="shows">
                    <span class="iconify" data-icon="lucide:clapperboard" data-width="16"></span>
                    <span>Shows</span>
                </div>

                <div style="padding-top: 1rem; padding-bottom: 0.5rem;">
                    <div class="text-[9px] uppercase tracking-[0.16em] px-1" style="color: var(--text-muted);">System</div>
                </div>

                <div class="nav-item" data-tab="performance">
                    <span class="iconify" data-icon="lucide:activity" data-width="16"></span>
                    <span>Performance</span>
                </div>
                <div class="nav-item" data-tab="settings">
                    <span class="iconify" data-icon="lucide:settings" data-width="16"></span>
                    <span>Settings</span>
                </div>
            </nav>

            <div class="p-4 border-t border-white/5">
                <div class="grid grid-cols-2 gap-3 text-center">
                    <div>
                        <div class="text-lg font-semibold font-mono" style="color: var(--text-primary);"><span id="status-fps">--</span></div>
                        <div class="text-[9px] uppercase tracking-wide" style="color: var(--text-muted);">FPS</div>
                    </div>
                    <div>
                        <div class="text-lg font-semibold font-mono" style="color: var(--text-primary);"><span id="status-mem">--</span></div>
                        <div class="text-[9px] uppercase tracking-wide" style="color: var(--text-muted);">Heap</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col overflow-hidden">

            <!-- LED VISUALIZATION (EXACT V2 CODE) -->
            <section class="w-full flex flex-col items-center" style="background: linear-gradient(180deg, #0a0a0a 0%, #000 100%); padding: 1.5rem;">
                <div class="w-full max-w-[960px] aspect-[32/7] card relative overflow-hidden" style="box-shadow: 0 0 40px rgba(0, 212, 255, 0.1);">
                    <!-- Zone boundary lines (V2) -->
                    <div class="absolute inset-0 pointer-events-none">
                        <div class="absolute left-[17%] top-0 bottom-0 w-px" style="background: var(--zone-3-color); opacity: 0.3;"></div>
                        <div class="absolute left-[33%] top-0 bottom-0 w-px" style="background: var(--zone-2-color); opacity: 0.3;"></div>
                        <div class="absolute left-1/2 top-0 bottom-0 w-px" style="background: var(--zone-1-color); opacity: 0.5;"></div>
                        <div class="absolute right-[33%] top-0 bottom-0 w-px" style="background: var(--zone-2-color); opacity: 0.3;"></div>
                        <div class="absolute right-[17%] top-0 bottom-0 w-px" style="background: var(--zone-3-color); opacity: 0.3;"></div>
                    </div>
                    <canvas id="viz-canvas" class="w-full h-full block" role="img" aria-label="LED visualization"></canvas>
                    <div class="absolute bottom-2 left-2 text-[10px] font-mono" style="color: var(--text-muted);">LED 0</div>
                    <div class="absolute bottom-2 right-2 text-[10px] font-mono" style="color: var(--text-muted);">LED 159</div>
                    <div class="absolute top-2 left-1/2 -translate-x-1/2 text-[10px] font-mono px-2 py-0.5 rounded" style="background: var(--bg-surface); color: var(--zone-1-color);">CENTER</div>
                </div>
            </section>

            <!-- Tab Content Area -->
            <div class="flex-1 overflow-y-auto">
                <div class="max-w-5xl mx-auto px-6 py-6">

                    <!-- TAB: COMPOSER -->
                    <div id="tab-composer" class="tab-content active">
                        <div class="grid grid-cols-12 gap-5">
                            <div class="col-span-7 space-y-5">

                                <!-- Now Playing -->
                                <div class="card p-5">
                                    <div class="flex items-start justify-between mb-5">
                                        <div>
                                            <div class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted); margin-bottom: 4px;">Now Playing</div>
                                            <div class="text-xl font-semibold font-mono" style="color: var(--gold);" id="status-fx">Aurora</div>
                                            <div class="text-xs mt-0.5" style="color: var(--text-secondary);" id="current-category">LGP Advanced</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted); margin-bottom: 4px;">Palette</div>
                                            <div class="text-sm font-medium" style="color: var(--text-primary);" id="current-palette">Ocean Breeze</div>
                                            <div id="current-palette-preview" class="h-2 w-24 rounded-full mt-1.5" style="background: linear-gradient(90deg, #0a0607, #016f8f, #91d1ff);"></div>
                                        </div>
                                    </div>

                                    <div class="space-y-4">
                                        <div>
                                            <div class="flex justify-between text-xs mb-2">
                                                <span class="font-display uppercase tracking-wide" style="color: var(--text-muted);">Master Brightness</span>
                                                <span class="font-mono" style="color: var(--text-primary);" id="brightness-value">128</span>
                                            </div>
                                            <input type="range" min="0" max="255" value="128" class="slider-input" id="brightness-slider">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-xs mb-2">
                                                <span class="font-display uppercase tracking-wide" style="color: var(--text-muted);">Global Speed</span>
                                                <span class="font-mono" style="color: var(--text-primary);" id="speed-value">25</span>
                                            </div>
                                            <input type="range" min="1" max="50" value="25" class="slider-input" id="speed-slider">
                                        </div>
                                    </div>
                                </div>

                                <!-- Zone Mixer -->
                                <div class="card p-5">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted);">Zone Mixer</div>
                                        <select class="text-xs border border-white/5 rounded px-2 py-1 font-mono" style="background: var(--bg-elevated); color: var(--text-secondary);" id="sync-mode">
                                            <option value="1">Synchronized</option>
                                            <option value="2">Mirrored</option>
                                            <option value="0">Independent</option>
                                            <option value="3">Chase</option>
                                        </select>
                                    </div>

                                    <div class="grid grid-cols-3 gap-6">
                                        <div class="text-center">
                                            <div class="relative h-20 flex items-end justify-center mb-3">
                                                <div class="w-3 rounded-t-sm transition-all zone-bar" data-zone="0" style="height: 75%; background: var(--zone-1-color);"></div>
                                            </div>
                                            <div class="w-2.5 h-2.5 rounded-full mx-auto mb-1" style="background: var(--zone-1-color); box-shadow: 0 0 12px var(--zone-1-color);"></div>
                                            <div class="text-xs font-semibold">Bass</div>
                                            <div class="text-[9px] font-mono" style="color: var(--text-muted);">LED 54-104</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="relative h-20 flex items-end justify-center mb-3">
                                                <div class="w-3 rounded-t-sm transition-all zone-bar" data-zone="1" style="height: 55%; background: var(--zone-2-color);"></div>
                                            </div>
                                            <div class="w-2.5 h-2.5 rounded-full mx-auto mb-1" style="background: var(--zone-2-color); box-shadow: 0 0 12px var(--zone-2-color);"></div>
                                            <div class="text-xs font-semibold">Mid</div>
                                            <div class="text-[9px] font-mono" style="color: var(--text-muted);">LED 27-53</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="relative h-20 flex items-end justify-center mb-3">
                                                <div class="w-3 rounded-t-sm transition-all zone-bar" data-zone="2" style="height: 35%; background: var(--zone-3-color);"></div>
                                            </div>
                                            <div class="w-2.5 h-2.5 rounded-full mx-auto mb-1" style="background: var(--zone-3-color); box-shadow: 0 0 12px var(--zone-3-color);"></div>
                                            <div class="text-xs font-semibold">High</div>
                                            <div class="text-[9px] font-mono" style="color: var(--text-muted);">LED 0-26</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Visual Pipeline -->
                                <details class="card overflow-hidden group" open>
                                    <summary class="flex items-center justify-between p-5 cursor-pointer select-none list-none hover:bg-white/[0.02] transition-colors">
                                        <span class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted);">Visual Pipeline</span>
                                        <span class="iconify group-open:rotate-180 transition-transform" style="color: var(--text-muted);" data-icon="lucide:chevron-down" data-width="14"></span>
                                    </summary>
                                    <div class="px-5 pb-5 grid grid-cols-2 gap-4">
                                        <div>
                                            <div class="flex justify-between text-[10px] mb-1.5">
                                                <span class="font-display uppercase tracking-wide" style="color: var(--text-muted);">Intensity</span>
                                                <span class="font-mono" style="color: var(--text-secondary);" id="val-int">128</span>
                                            </div>
                                            <input type="range" min="0" max="255" value="128" class="slider-input" id="slider-intensity">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-[10px] mb-1.5">
                                                <span class="font-display uppercase tracking-wide" style="color: var(--text-muted);">Saturation</span>
                                                <span class="font-mono" style="color: var(--text-secondary);" id="val-sat">200</span>
                                            </div>
                                            <input type="range" min="0" max="255" value="200" class="slider-input" id="slider-saturation">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-[10px] mb-1.5">
                                                <span class="font-display uppercase tracking-wide" style="color: var(--text-muted);">Complexity</span>
                                                <span class="font-mono" style="color: var(--text-secondary);" id="val-com">128</span>
                                            </div>
                                            <input type="range" min="0" max="255" value="128" class="slider-input" id="slider-complexity">
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-[10px] mb-1.5">
                                                <span class="font-display uppercase tracking-wide" style="color: var(--text-muted);">Variation</span>
                                                <span class="font-mono" style="color: var(--text-secondary);" id="val-var">128</span>
                                            </div>
                                            <input type="range" min="0" max="255" value="128" class="slider-input" id="slider-variation">
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <!-- Quick Access & Effect Browser -->
                            <div class="col-span-5 space-y-5">
                                <div class="card p-4">
                                    <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-3" style="color: var(--text-muted);">Quick Access</div>
                                    <div class="grid grid-cols-5 gap-2">
                                        <button class="flex flex-col items-center gap-1.5 p-2.5 rounded-lg transition-colors group" style="background: var(--bg-elevated);">
                                            <span class="iconify group-hover:text-white" style="color: var(--text-secondary);" data-icon="lucide:heart-pulse" data-width="18"></span>
                                            <span class="text-[9px]" style="color: var(--text-muted);">Pulse</span>
                                        </button>
                                        <button class="flex flex-col items-center gap-1.5 p-2.5 rounded-lg transition-colors group" style="background: var(--bg-elevated);">
                                            <span class="iconify group-hover:text-white" style="color: var(--text-secondary);" data-icon="lucide:waves" data-width="18"></span>
                                            <span class="text-[9px]" style="color: var(--text-muted);">Wave</span>
                                        </button>
                                        <button class="flex flex-col items-center gap-1.5 p-2.5 rounded-lg border transition-colors" style="background: var(--gold-glow); border-color: rgba(255,184,77,0.3);">
                                            <span class="iconify" style="color: var(--gold);" data-icon="lucide:sparkles" data-width="18"></span>
                                            <span class="text-[9px]" style="color: var(--gold);">Aurora</span>
                                        </button>
                                        <button class="flex flex-col items-center gap-1.5 p-2.5 rounded-lg transition-colors group" style="background: var(--bg-elevated);">
                                            <span class="iconify group-hover:text-white" style="color: var(--text-secondary);" data-icon="lucide:flame" data-width="18"></span>
                                            <span class="text-[9px]" style="color: var(--text-muted);">Fire</span>
                                        </button>
                                        <button class="flex flex-col items-center gap-1.5 p-2.5 rounded-lg transition-colors group" style="background: var(--bg-elevated);">
                                            <span class="iconify group-hover:text-white" style="color: var(--text-secondary);" data-icon="lucide:scan-line" data-width="18"></span>
                                            <span class="text-[9px]" style="color: var(--text-muted);">Scan</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="card p-4 flex flex-col" style="height: 340px;">
                                    <div class="flex items-center gap-2 mb-3 flex-wrap" id="category-chips">
                                        <span class="chip active" data-category="all">All</span>
                                        <span class="chip" data-category="classic">Classic</span>
                                        <span class="chip" data-category="lgp">LGP</span>
                                        <span class="chip" data-category="physics">Physics</span>
                                        <span class="chip" data-category="quantum">Quantum</span>
                                    </div>

                                    <div class="flex-1 overflow-y-auto space-y-0.5" id="effect-list">
                                        <!-- Effects populated by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: EFFECTS -->
                    <div id="tab-effects" class="tab-content">
                        <div class="mb-6">
                            <h2 class="text-lg font-semibold font-mono mb-1">Effect Library</h2>
                            <p class="text-sm" style="color: var(--text-secondary);">46+ effects across 6 categories</p>
                        </div>

                        <div class="flex items-center gap-2 mb-5 flex-wrap" id="effects-category-chips">
                            <span class="chip active" data-category="all">All</span>
                            <span class="chip" data-category="classic">Classic</span>
                            <span class="chip" data-category="lgp">LGP</span>
                            <span class="chip" data-category="physics">Physics</span>
                            <span class="chip" data-category="quantum">Quantum</span>
                            <span class="chip" data-category="organic">Organic</span>
                        </div>

                        <div class="grid grid-cols-3 gap-3" id="effects-grid">
                            <!-- Effects populated by JS -->
                        </div>
                    </div>

                    <!-- TAB: PALETTES -->
                    <div id="tab-palettes" class="tab-content">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h2 class="text-lg font-semibold font-mono mb-1">Color Palettes</h2>
                                <p class="text-sm" style="color: var(--text-secondary);">33 gradient palettes</p>
                            </div>
                            <div class="card p-4 flex items-center gap-4">
                                <div>
                                    <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-1" style="color: var(--text-muted);">Auto Cycle</div>
                                    <div class="toggle active" id="palette-autocycle"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-1" style="color: var(--text-muted);">Interval</div>
                                    <select class="text-xs border border-white/5 rounded px-2 py-1 font-mono" style="background: var(--bg-elevated); color: var(--text-secondary);">
                                        <option>5s</option>
                                        <option>10s</option>
                                        <option>30s</option>
                                        <option>60s</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-4 gap-3" id="palette-grid">
                            <!-- Palettes populated by JS -->
                        </div>
                    </div>

                    <!-- TAB: TRANSITIONS -->
                    <div id="tab-transitions" class="tab-content">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h2 class="text-lg font-semibold font-mono mb-1">Transitions</h2>
                                <p class="text-sm" style="color: var(--text-secondary);">12 CENTER ORIGIN transition types</p>
                            </div>
                            <div class="card p-4 flex items-center gap-4">
                                <div>
                                    <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-1" style="color: var(--text-muted);">Random</div>
                                    <div class="toggle" id="toggle-transitions"></div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-12 gap-5">
                            <div class="col-span-8">
                                <div class="grid grid-cols-4 gap-3" id="transition-grid">
                                    <!-- Transitions populated by JS -->
                                </div>
                            </div>
                            <div class="col-span-4 space-y-4">
                                <div class="card p-5">
                                    <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-4" style="color: var(--text-muted);">Settings</div>
                                    <div class="space-y-4">
                                        <div>
                                            <div class="flex justify-between text-xs mb-2">
                                                <span class="font-display uppercase tracking-wide" style="color: var(--text-muted);">Duration</span>
                                                <span class="font-mono" style="color: var(--text-primary);" id="transition-duration-val">2000ms</span>
                                            </div>
                                            <input type="range" min="500" max="5000" value="2000" step="100" class="slider-input" id="transition-duration">
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-display uppercase tracking-wide mb-2" style="color: var(--text-muted);">Easing Curve</div>
                                            <select class="w-full text-xs border border-white/5 rounded-lg px-3 py-2 font-mono" style="background: var(--bg-elevated); color: var(--text-secondary);" id="transition-easing">
                                                <option>Linear</option>
                                                <option>Ease In Quad</option>
                                                <option>Ease Out Quad</option>
                                                <option selected>Ease In Out Quad</option>
                                                <option>Ease Out Elastic</option>
                                                <option>Ease Out Bounce</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="card p-5">
                                    <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-3" style="color: var(--text-muted);">Preview</div>
                                    <div class="h-16 rounded-lg relative overflow-hidden" style="background: var(--bg-elevated);" id="transition-preview">
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="w-1 h-full transition-preview-line" style="background: var(--gold);"></div>
                                        </div>
                                    </div>
                                    <button class="w-full mt-3 py-2 rounded-lg text-xs font-display uppercase tracking-wide transition-colors hover:bg-white/[0.06]" style="background: var(--bg-elevated); color: var(--text-secondary);">
                                        Test Transition
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: SHOWS -->
                    <div id="tab-shows" class="tab-content">
                        <div class="mb-6">
                            <h2 class="text-lg font-semibold font-mono mb-1">Shows</h2>
                            <p class="text-sm" style="color: var(--text-secondary);">Choreographed multi-minute light sequences</p>
                        </div>

                        <!-- Now Playing Bar -->
                        <div id="show-now-playing" class="hidden card p-4 mb-6 border" style="border-color: rgba(0,212,255,0.3);">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(0,212,255,0.2);">
                                        <span class="iconify" style="color: var(--accent-primary);" data-icon="lucide:play" data-width="20"></span>
                                    </div>
                                    <div>
                                        <h3 id="show-now-playing-name" class="text-sm font-semibold text-white">--</h3>
                                        <p id="show-now-playing-chapter" class="text-xs" style="color: var(--text-secondary);">Chapter: --</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button onclick="pauseShow()" id="show-pause-btn" class="w-9 h-9 rounded-lg border flex items-center justify-center transition-colors" style="background: var(--bg-elevated); border-color: rgba(255,255,255,0.1); color: var(--text-secondary);">
                                        <span class="iconify" data-icon="lucide:pause" data-width="16"></span>
                                    </button>
                                    <button onclick="stopShow()" class="w-9 h-9 rounded-lg border flex items-center justify-center transition-colors" style="background: rgba(255,77,77,0.2); border-color: rgba(255,77,77,0.3); color: #ff4d4d;">
                                        <span class="iconify" data-icon="lucide:square" data-width="16"></span>
                                    </button>
                                </div>
                            </div>
                            <div class="relative h-2 rounded-full overflow-hidden mb-2" style="background: var(--bg-elevated);">
                                <div id="show-progress-bar" class="absolute left-0 top-0 h-full rounded-full transition-all duration-500" style="width: 0%; background: var(--accent-primary);"></div>
                            </div>
                            <div class="flex justify-between text-xs font-mono" style="color: var(--text-secondary);">
                                <span id="show-elapsed">0:00</span>
                                <span id="show-remaining">-0:00</span>
                            </div>
                        </div>

                        <div id="show-grid" class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <!-- Show cards populated by JS -->
                            <div class="col-span-full text-center py-4 text-sm" style="color: var(--text-muted);">Loading shows...</div>
                        </div>
                    </div>

                    <!-- TAB: PERFORMANCE -->
                    <div id="tab-performance" class="tab-content">
                        <div class="mb-6">
                            <h2 class="text-lg font-semibold font-mono mb-1">Performance Monitor</h2>
                            <p class="text-sm" style="color: var(--text-secondary);">Real-time system metrics</p>
                        </div>

                        <div class="grid grid-cols-4 gap-4 mb-6">
                            <div class="card p-5 text-center">
                                <div class="stat-gauge mx-auto mb-3">
                                    <svg width="80" height="80" viewBox="0 0 80 80">
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--bg-elevated)" stroke-width="6"/>
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--success)" stroke-width="6" stroke-dasharray="220" stroke-dashoffset="44" stroke-linecap="round"/>
                                    </svg>
                                    <div class="value">
                                        <span class="text-2xl font-bold font-mono" id="perf-fps">120</span>
                                    </div>
                                </div>
                                <div class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted);">FPS</div>
                            </div>
                            <div class="card p-5 text-center">
                                <div class="stat-gauge mx-auto mb-3">
                                    <svg width="80" height="80" viewBox="0 0 80 80">
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--bg-elevated)" stroke-width="6"/>
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--gold)" stroke-width="6" stroke-dasharray="220" stroke-dashoffset="127" stroke-linecap="round"/>
                                    </svg>
                                    <div class="value">
                                        <span class="text-2xl font-bold font-mono" id="perf-cpu">42</span>
                                        <span class="text-xs" style="color: var(--text-muted);">%</span>
                                    </div>
                                </div>
                                <div class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted);">CPU</div>
                            </div>
                            <div class="card p-5 text-center">
                                <div class="stat-gauge mx-auto mb-3">
                                    <svg width="80" height="80" viewBox="0 0 80 80">
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--bg-elevated)" stroke-width="6"/>
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--info)" stroke-width="6" stroke-dasharray="220" stroke-dashoffset="88" stroke-linecap="round"/>
                                    </svg>
                                    <div class="value">
                                        <span class="text-2xl font-bold font-mono" id="perf-heap">156</span>
                                        <span class="text-[9px]" style="color: var(--text-muted);">KB</span>
                                    </div>
                                </div>
                                <div class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted);">Free Heap</div>
                            </div>
                            <div class="card p-5 text-center">
                                <div class="stat-gauge mx-auto mb-3">
                                    <svg width="80" height="80" viewBox="0 0 80 80">
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--bg-elevated)" stroke-width="6"/>
                                        <circle cx="40" cy="40" r="35" fill="none" stroke="var(--success)" stroke-width="6" stroke-dasharray="220" stroke-dashoffset="198" stroke-linecap="round"/>
                                    </svg>
                                    <div class="value">
                                        <span class="text-2xl font-bold font-mono" id="perf-frag">12</span>
                                        <span class="text-xs" style="color: var(--text-muted);">%</span>
                                    </div>
                                </div>
                                <div class="text-[10px] font-display uppercase tracking-[0.16em]" style="color: var(--text-muted);">Fragmentation</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-5">
                            <div class="card p-5">
                                <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-4" style="color: var(--text-muted);">Timing Metrics</div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Effect Processing</span>
                                        <span class="font-mono text-sm">1,234 us</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">FastLED Show</span>
                                        <span class="font-mono text-sm">3,200 us</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Frame Budget</span>
                                        <span class="font-mono text-sm">8,333 us</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Data Rate</span>
                                        <span class="font-mono text-sm">7.68 Mbps</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card p-5">
                                <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-4" style="color: var(--text-muted);">Health Status</div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Dropped Frames</span>
                                        <span class="font-mono text-sm" style="color: var(--success);">0</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Min Free Heap</span>
                                        <span class="font-mono text-sm">85,420 bytes</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Uptime</span>
                                        <span class="font-mono text-sm" id="perf-uptime">--</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Temperature</span>
                                        <span class="font-mono text-sm">42C</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: SETTINGS -->
                    <div id="tab-settings" class="tab-content">
                        <div class="mb-6">
                            <h2 class="text-lg font-semibold font-mono mb-1">Settings</h2>
                            <p class="text-sm" style="color: var(--text-secondary);">Network, firmware, and device configuration</p>
                        </div>

                        <div class="grid grid-cols-2 gap-5">
                            <!-- Network -->
                            <div class="card p-5">
                                <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-4" style="color: var(--text-muted);">Network</div>
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(77,255,184,0.2);">
                                            <span class="iconify" style="color: var(--success);" data-icon="lucide:wifi" data-width="20"></span>
                                        </div>
                                        <div>
                                            <div class="font-medium">HomeNetwork_5G</div>
                                            <div class="text-xs" style="color: var(--text-secondary);">Connected - -42 dBm</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 pt-2 border-t border-white/5">
                                        <div>
                                            <div class="text-[10px] uppercase tracking-wide mb-1" style="color: var(--text-muted);">IP Address</div>
                                            <div class="font-mono text-sm">192.168.1.42</div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] uppercase tracking-wide mb-1" style="color: var(--text-muted);">mDNS</div>
                                            <div class="font-mono text-sm">lightwaveos.local</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Device Info -->
                            <div class="card p-5">
                                <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-4" style="color: var(--text-muted);">Device Info</div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Device</span>
                                        <span class="font-mono text-sm">K1-Lightwave</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Firmware</span>
                                        <span class="font-mono text-sm">v1.4.2</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Platform</span>
                                        <span class="font-mono text-sm">ESP32-S3</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm" style="color: var(--text-secondary);">Flash Size</span>
                                        <span class="font-mono text-sm">8 MB</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- OTA Update -->
                        <div class="card p-5 mt-5">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-[10px] font-display uppercase tracking-[0.16em] mb-1" style="color: var(--text-muted);">OTA Update</div>
                                    <div class="text-sm" style="color: var(--text-secondary);">Upload new firmware via browser</div>
                                </div>
                                <label class="px-4 py-2 rounded-lg text-sm font-display uppercase tracking-wide cursor-pointer transition-colors hover:bg-white/[0.06]" style="background: var(--bg-elevated); color: var(--text-secondary);">
                                    <input type="file" class="hidden" accept=".bin" id="firmware-file">
                                    Select File
                                </label>
                            </div>
                            <div id="firmware-progress" class="hidden mt-4">
                                <div class="w-full rounded-full h-2 overflow-hidden" style="background: var(--bg-elevated);">
                                    <div id="firmware-progress-bar" class="h-2 rounded-full transition-all duration-300" style="width: 0%; background: var(--accent-primary);"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Preset Bar -->
            <div class="border-t border-white/5 px-6 py-4" style="background: linear-gradient(180deg, #0a0a0a 0%, #000 100%);">
                <div class="max-w-5xl mx-auto flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <button class="preset-btn" onclick="loadPreset(0)">P0</button>
                        <button class="preset-btn" onclick="loadPreset(1)">P1</button>
                        <button class="preset-btn active" onclick="loadPreset(2)">P2</button>
                        <button class="preset-btn" onclick="loadPreset(3)">P3</button>
                        <button class="preset-btn" onclick="loadPreset(4)">P4</button>
                        <button class="preset-btn ml-2 flex items-center justify-center" title="Save Preset" onclick="savePreset()">
                            <span class="iconify" data-icon="lucide:save" data-width="14"></span>
                        </button>
                    </div>

                    <button class="w-12 h-12 rounded-xl flex items-center justify-center glow-gold transition-transform hover:scale-105" style="background: var(--gold); color: black;" aria-label="Power">
                        <span class="iconify" data-icon="lucide:power" data-width="20"></span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // =====================================================
        // V2 CANVAS VISUALIZATION (EXACT COPY)
        // =====================================================
        const canvas = document.getElementById('viz-canvas');
        const ctx = canvas.getContext('2d');

        function setupCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }

        function drawVisualizer() {
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);
            ctx.clearRect(0, 0, width, height);

            const ledCount = 160;  // Updated from 158 to match actual hardware
            const center = ledCount / 2;
            const stripY = height / 2;
            const ledW = width / ledCount;
            const ledH = height * 0.55;

            ctx.fillStyle = '#1a1f2e';
            ctx.fillRect(0, stripY - ledH/2, width, ledH);

            const time = Date.now() / 1500;

            for (let i = 0; i < ledCount; i++) {
                const distFromCenter = Math.abs(i - center);
                let color, alpha;

                // V2 zone colors (EXACT)
                if (distFromCenter < 26) {
                    color = '#6ee7f3';  // Bass - zone 1
                    alpha = 0.78;
                } else if (distFromCenter < 52) {
                    color = '#22dd88';  // Mid - zone 2
                    alpha = 0.59;
                } else {
                    color = '#ffb84d';  // High - zone 3
                    alpha = 0.39;
                }

                // CENTER ORIGIN animation
                const wave = (Math.sin(time + i * 0.08) + 1) / 2;
                const pulse = (Math.sin(time * 1.5 + distFromCenter * 0.05) + 1) / 2;
                const finalAlpha = Math.max(0.15, alpha * (0.4 + 0.6 * wave * pulse));

                ctx.fillStyle = color;
                ctx.globalAlpha = finalAlpha;
                ctx.fillRect(i * ledW + 0.5, stripY - ledH/2, ledW - 1, ledH);
                ctx.globalAlpha = 1;
            }

            requestAnimationFrame(drawVisualizer);
        }

        // Tab navigation
        document.querySelectorAll('.nav-item[data-tab]').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                const tabId = item.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                document.getElementById(`tab-${tabId}`).classList.add('active');
            });
        });

        // Toggle clicks
        document.querySelectorAll('.toggle').forEach(toggle => {
            toggle.addEventListener('click', () => toggle.classList.toggle('active'));
        });

        // Chip clicks
        document.querySelectorAll('.chip').forEach(chip => {
            chip.addEventListener('click', () => {
                chip.parentElement.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
            });
        });

        // Preset button clicks
        document.querySelectorAll('.preset-btn:not(:last-child)').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Initialize canvas
        window.addEventListener('DOMContentLoaded', () => {
            setupCanvas();
            requestAnimationFrame(drawVisualizer);
        });
        window.addEventListener('resize', setupCanvas);
    </script>

    <!-- QR Code Library (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" async defer></script>
    <script src="app.js"></script>
</body>
</html>
