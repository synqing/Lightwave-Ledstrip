# LightwaveOS iOS v2

SwiftUI dashboard for the LightwaveOS 320-LED Light Guide Plate controller. Music visualisation tool meant to INSPIRE.

## Build

```bash
# Open in Xcode (iOS 17+, Swift 6)
open LightwaveOS.xcodeproj
# Or: xcodebuild -scheme LightwaveOS -destination 'platform=iOS Simulator,name=iPhone 16'
```

## Architecture Decisions

- **Navigation:** Bottom `TabView` â€” Play | Zones | Audio | Device
- **LED Preview:** Horizontal strip default (Canvas-based, 320 LEDs). Concentric ring mode optional.
- **State:** `@Observable` ViewModels on `@MainActor`, injected via `.environment()`
- **Network:** REST (`/api/v1/*`) + WebSocket (`ws://device/ws`) + UDP (port 41234 for LED/audio streaming). WS for commands, UDP for binary frames.
- **No third-party UI libraries.** Pure SwiftUI + Apple frameworks, **except** the Rive runtime for UI animation assets only.

## Hard Constraints

- **Centre origin**: All LED visualisations must reflect LEDs 79/80 as centre point.
- **Performance**: Canvas rendering for LED preview. No 320 individual SwiftUI views.
- **Debounce**: All slider â†’ network calls debounced 150ms. Pending flags prevent WS echo-back.
- **British English** in comments and docs.

## Design Principles

1. **Show the output** â€” LED strip preview is the hero element, not settings panels.
2. **Feel the music** â€” BPM and beat events are first-class. UI pulses on beats.
3. **Invite exploration** â€” Effects and palettes are visual (cards, swatches), not text lists.

## Further Docs

| Topic | File |
|-------|------|
| Full API reference | [mockups/API_REFERENCE.md](mockups/API_REFERENCE.md) |
| API gaps for iOS | [mockups/API_AUDIT.md](mockups/API_AUDIT.md) |
| Design mockup (balanced) | [mockups/balanced.html](mockups/balanced.html) |
| Implementation plan | [docs/DESIGN_SPEC.md](docs/DESIGN_SPEC.md) |
| Rive integration | [docs/RIVE_INTEGRATION.md](docs/RIVE_INTEGRATION.md) |
| Rive asset contract | [docs/RIVE_ASSET_CONTRACT.md](docs/RIVE_ASSET_CONTRACT.md) |
| Rive perf notes | [docs/RIVE_PERF_NOTES.md](docs/RIVE_PERF_NOTES.md) |
| Rive UX checklist | [docs/RIVE_UX_CHECKLIST.md](docs/RIVE_UX_CHECKLIST.md) |
| v1 source (reference) | [../lightwave-ios/](../lightwave-ios/) |
| Firmware API docs | [../docs/api/api-v1.md](../docs/api/api-v1.md) |
| Audio-reactive protocol | [../docs/audio-visual/audio-visual-semantic-mapping.md](../docs/audio-visual/audio-visual-semantic-mapping.md) |

## Tab Structure

```
Play tab:
  HeroLEDPreview (120pt, live 320-LED strip via Canvas)
  PatternPill + PalettePill (full-width, tappable â†’ sheet)
  Brightness slider (full-width, 10pt track)
  Speed slider (full-width)
  ExpressionParametersCard (collapsible: mood, trails, hue, sat, intensity, complexity, variation)
  TransitionCard (type picker, duration, trigger)

Zones tab:
  ZoneHeaderCard (toggle, count selector, preset picker)
  LEDStripView (60pt, zone-coloured segments)
  Per-zone ZoneCards (effect/palette/blend dropdowns, speed/brightness sliders)

Audio tab:
  BPMHeroCard (48pt number, beat ring, confidence arc)
  AudioParametersCard (mic type, gain, sensitivity)
  AudioReactiveEffectsCard (filtered quick-select grid)

Device tab:
  NavigationStack + List (device info, colour correction, presets, shows, debug log)
```

## Key Files (v1 reference â†’ v2 target)

| v1 File | v2 File | Changes |
|---------|---------|---------|
| `Views/RootView.swift` | `Views/Tabs/PlayTab.swift` | ScrollViewâ†’TabView, hero LED, new spacing |
| `Views/StatusBarView.swift` | `Views/Shared/PersistentStatusBar.swift` | 26ptâ†’44pt, connection + now-playing |
| `Views/ZoneModeView.swift` | `Views/Zones/ZonesTab.swift` | Full zone controls, preset picker |
| `Views/AdvancedParamsView.swift` | `Views/Play/ExpressionParametersCard.swift` | Semantic groups, endpoint labels |
| `Theme/DesignTokens.swift` | `Theme/DesignTokens.swift` | Expanded typography, shadows, gradients |
| `Models/PaletteMetadata.swift` | `Models/PaletteMetadata.swift` | Add `colors: [Color]` for swatches |
| â€” | `Views/Play/HeroLEDPreview.swift` | NEW: Canvas-based 320-LED preview |
| â€” | `Views/Play/TransitionCard.swift` | NEW: 12 transition types |
| â€” | `Views/Audio/BPMHeroCard.swift` | NEW: 48pt BPM with beat ring |
| â€” | `ViewModels/TransitionViewModel.swift` | NEW: transition state |
| â€” | `ViewModels/ColourCorrectionViewModel.swift` | NEW: gamma, AE, guardrail |


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 1, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #24697 | 9:11 AM | ðŸ”µ | XcodeGen Project Configuration Structure | ~527 |
| #24687 | 9:07 AM | ðŸ”µ | LightwaveOS v2 README Comprehensive Project Documentation | ~572 |
| #24685 | " | ðŸ”µ | LightwaveOS v2 iOS Development Constraints and Architecture | ~591 |

### Feb 5, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #25462 | 9:37 PM | âœ… | Portable Mode implementation staged for commit across all three platforms | ~447 |
| #25456 | 9:36 PM | âœ… | Added entitlements file path to XcodeGen project configuration | ~407 |
| #25454 | " | ðŸ”´ | iOS Xcode project regenerated to fix missing resource references | ~371 |
| #25432 | 9:28 PM | ðŸ”µ | iOS WiFi Information entitlement already configured in project | ~377 |
| #25412 | 8:36 PM | ðŸŸ£ | iOS app now supports direct AP connection, network change detection, and last-device reconnection | ~752 |

### Feb 6, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #25572 | 12:26 AM | ðŸ”µ | iOS Quick Connect button broken because it requires manual WiFi network join | ~751 |
| #25566 | 12:25 AM | ðŸ”µ | iOS project.yml contains NSLocationWhenInUseUsageDescription for WiFi network detection | ~478 |
| #25565 | " | âœ… | WiFi Information entitlement removed from iOS app due to Apple Developer account requirement | ~384 |
</claude-mem-context>
