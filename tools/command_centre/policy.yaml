domains:
  firmware_effects:
    patterns:
      - "firmware/v2/src/effects/**"
      - "firmware/v2/src/plugins/**"
    agent: "embedded"
    constraints:
      - "centre-origin (LEDs 79/80)"
      - "no heap allocation in render loops"
      - "120+ FPS target"
    required_checks:
      - command: "validate <effectId>"
        description: "Centre-origin, hue-span, FPS, heap-delta validation"
      - command: "s"
        description: "FPS/CPU check via serial command"
  
  network_api:
    patterns:
      - "firmware/v2/src/network/**"
    agent: "api"
    constraints:
      - "protected file protocols"
      - "additive JSON only"
      - "thread safety"
    required_checks:
      - command: "pio run -e esp32dev_audio_esv11"
        description: "Build verification"
  
  dashboard_ui:
    patterns:
      - "lightwave-dashboard/**"
    agent: "frontend"
    constraints:
      - "accessibility (WCAG 2.1 AA)"
      - "E2E tests"
      - "no inline responsive styles"
    required_checks:
      - command: "npm run test:e2e"
        description: "E2E test suite"
  
  documentation:
    patterns:
      - "docs/**"
    agent: "documentation"
    constraints:
      - "British English (centre/colour/initialise)"
      - "spelling consistency"
    required_checks: []

protected_files:
  - pattern: "firmware/v2/src/network/WiFiManager.*"
    level: "CRITICAL"
    checks:
      - "FreeRTOS EventGroup bit clearing"
      - "mutex-protected state transitions"
    mandatory_reads:
      - ".claude/harness/PROTECTED_FILES.md"
      - "WiFiManager.cpp"
  
  - pattern: "firmware/v2/src/network/WebServer.*"
    level: "HIGH"
    checks:
      - "rate limiting thread safety"
      - "WebSocket handler synchronization"
  
  - pattern: "firmware/v2/src/audio/AudioActor.*"
    level: "HIGH"
    checks:
      - "cross-core atomic buffer correctness"
      - "lock-free double-buffering"

tool_allowlist:
  firmware_effects:
    allow:
      - "read_file"
      - "codebase_search"
      - "grep"
      - "run_terminal_cmd"
    allow_scopes:
      - "repo_read"
      - "terminal_exec"
    deny:
      - "run_terminal_cmd.*upload"
      - "run_terminal_cmd.*rm -rf"
  
  network_api:
    allow:
      - "read_file"
      - "codebase_search"
      - "grep"
    allow_scopes:
      - "repo_read"
    deny:
      - "run_terminal_cmd.*upload"
      - "run_terminal_cmd.*rm -rf"
  
  dashboard_ui:
    allow:
      - "read_file"
      - "codebase_search"
      - "grep"
      - "run_terminal_cmd"
    allow_scopes:
      - "repo_read"
      - "terminal_exec"
    deny:
      - "run_terminal_cmd.*rm -rf"
      - "run_terminal_cmd.*chmod"
  
  documentation:
    allow:
      - "read_file"
      - "codebase_search"
      - "grep"
    allow_scopes:
      - "repo_read"
    deny:
      - "run_terminal_cmd"

resource_scopes:
  repo_read:
    description: "Read-only access to repository files"
    tools:
      - "read_file"
      - "codebase_search"
      - "grep"

  firmware_write:
    description: "Write access to firmware directory only"
    tools:
      - "write_file"
      - "edit_file"
    paths:
      - "firmware/**"

  terminal_exec:
    description: "Terminal execution commands"
    tools:
      - "run_terminal_cmd"

  network_prohibited:
    description: "No network access"
    deny:
      - "curl"
      - "wget"
      - "http_request"
