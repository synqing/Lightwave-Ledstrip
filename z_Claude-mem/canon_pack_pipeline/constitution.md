# Constitution

## Evidence Table
- `mission_audio_reactive` | type=mission | status=superseded | confidence=high | first_seen=2025-06-23T20:30:27Z | last_seen=2026-02-09T16:01:39.531000Z
  - statement: The project mission is an audio-reactive LED controller experience with web/app control.
  - [O28425] 2026-02-09T16:01:39.531Z | Lightwave-Ledstrip | Examined PatternRegistry pattern families for color handling architecture PatternRegistry.cpp defines PatternFamily taxonomy with FLUID_PLASMA, GEOMETRIC, and other categories using CENTER_ORIGIN and palette-driven rendering.
  - [O28424] 2026-02-09T16:01:31.824Z | Lightwave-Ledstrip | PatternFamily::REACTIVE compilation error in WaveformParity registration WaveformParityEffect registration failed due to incorrect PatternFamily enum value REACTIVE not existing in codebase The WaveformParityEffect registration in PatternRegistry.cpp failed to compile because it referenced PatternFamily::REACTIVE, whi…
  - [O28417] 2026-02-09T15:56:19.430Z | Lightwave-Ledstrip | Examined SbWaveform310RefEffect reference implementation for palette-free color summation pattern SbWaveform310RefEffect uses note-chromagram color summation in chromatic mode, providing reference for multi-color injection without palette corruption.
  - [O28416] 2026-02-09T15:56:17.412Z | Lightwave-Ledstrip | Waveform Effect Implementations in LightwaveOS Effects directory contains multiple waveform visualizers including Sensory Bridge and ESv11 reference implementations The effects directory contains a comprehensive set of waveform visualization implementations spanning multiple audio visualization paradigms.
- `invariant_centre_origin` | type=invariant | status=superseded | confidence=high | first_seen=2025-06-23T20:47:44Z | last_seen=2026-02-09T15:54:01.001000Z
  - statement: Effects originate from centre LEDs 79/80 and propagate outward/inward, not linear sweeps.
  - [O28415] 2026-02-09T15:54:01.001Z | Lightwave-Ledstrip | Firmware Successfully Flashed to Device with Palette-Driven Bloom and Runtime Control Infrastructure Deployed firmware to esp32dev_audio_esv11 hardware in 39.86 seconds with dual-layer motion system and externalized parameters The firmware was successfully deployed to the ESP32-S3 hardware running the esp32dev_audio_e…
  - [O28246] 2026-02-08T21:45:07.109Z | Lightwave-Ledstrip | Pattern Metadata Describes Beat Pulse Bloom at ID 121 PatternRegistry metadata at ID 121 still references Beat Pulse Bloom with beat+flux injection rather than BloomParityEffect A metadata inconsistency exists at pattern ID 121.
  - [O28235] 2026-02-08T21:42:04.041Z | Lightwave-Ledstrip | Effect Registration Pattern Using Static Instances CoreEffects.cpp registers effects via static instances with renderer->registerEffect() pattern, ID 98 currently occupied by SnapwaveLinearEffect The effect registration system in CoreEffects.cpp uses a static instance pattern where each effect is declared as a static…
  - [O28127] 2026-02-08T15:16:44.955Z | Lightwave-Ledstrip | Firmware Build Succeeded After BeatPulseBloom Fixes Clean build completed in 46.65 seconds with 30.6% flash and 34.4% RAM usage, validating Sensory Bridge transport reversion and silentScale fix.
- `invariant_no_rainbow` | type=invariant | status=superseded | confidence=high | first_seen=2025-06-23T23:54:39Z | last_seen=2026-02-09T15:21:35.350000Z
  - statement: Rainbow cycling and full hue-wheel sweeps are disallowed.
  - [O28393] 2026-02-09T15:21:35.350Z | Lightwave-Ledstrip | Palette Usage Pattern in LGPBoxWaveEffect Effect uses ctx.palette.getColor with hue-based index and calculated brightness for color wave rendering The LGPBoxWaveEffect demonstrates standard palette usage patterns in LightwaveOS effects.
  - [O28371] 2026-02-09T15:06:39.797Z | Lightwave-Ledstrip | Bloom Injection Refactored to Palette-Driven Color System Replaced HSV color summation with direct palette sampling, mapping 12 chroma bins to palette positions for dynamic color vocabulary The Bloom injection computation was completely refactored from HSV-based color summation to a palette-driven system.
  - [O28358] 2026-02-09T14:56:27.180Z | Lightwave-Ledstrip | User Requests Prism Opacity Uncapping and Palette-Based Color System Two enhancement requests: remove 1.0 prism opacity cap for extreme ghosting effects, replace HSV with palette-driven color User provided feedback on Bloom parity implementation, confirming the prism effect's ghost layering behavior works as designed…
  - [O28311] 2026-02-09T07:41:59.522Z | Lightwave-Ledstrip | FastLED Color Parity Fixes Compiled Successfully Build completed with forceSaturation 8-bit round-trip and FastLED CHSV rainbow HSV model integration The firmware successfully compiled after implementing the two critical color model changes for Sensory Bridge parity.
- `invariant_no_heap_render` | type=invariant | status=superseded | confidence=high | first_seen=2025-09-23T11:12:45.208000Z | last_seen=2026-02-09T15:12:29.525000Z
  - statement: Render paths avoid dynamic heap allocation and use static buffers.
  - [O28387] 2026-02-09T15:12:29.525Z | Lightwave-Ledstrip | Prism Iterations Converted from Constant to Runtime-Tunable Variable Changed kPrismIterations from constexpr to static s_prismIterations for dynamic adjustment during effect runtime The prism iteration count was refactored from a compile-time constant (kPrismIterations) to a runtime-tunable static variable (s_prismIte…
  - [O28285] 2026-02-09T07:30:48.198Z | Lightwave-Ledstrip | ZonePresetsCard Rebuilt Successfully After AppViewModel Timing Adjustments App recompiled with reverted timing changes, compiling ZonePresetsCard.swift without errors alongside zone-related files.
  - [O28286] 2026-02-09T07:30:37.411Z | Lightwave-Ledstrip | Existing BloomParityEffect.cpp Implementation Details Implementation contains complete transport pipeline with subpixel advection, chroma injection, and hue shift but lacks post-FX layers The BloomParityEffect.cpp implementation provides a complete port of Sensory Bridge's Bloom transport mechanics.
  - [O28100] 2026-02-08T14:07:13.926Z | Lightwave-Ledstrip | Sensory Bridge Bloom Formula Restored in BeatPulseBloomEffect Transport Tuning Transport velocity driven by MOOD parameter (0.25 + 1.75*MOOD) with speed as multiplier, fadeAmount controls persistence.
  - conflicts:
    - [O24361] 2026-01-31T22:12:35.833Z | lightwave-controller | Root ARCHITECTURE.md provides extracted system facts for agent quick reference 234-line document distills key architectural information from extensive docs/architecture/ directory The root ARCHITECTURE.md implements progressive disclosure by extracting essential architectural facts from the extensive docs/architecture…
    - [O12111] 2026-01-06T22:10:24.934Z | v2 | Agent Progress Log and Lessons Learned Progress log tracks agent runs with persistent lessons on build issues, effect development patterns, and common failures The project maintains a comprehensive agent progress log using an append-only format to track all agent execution runs.
    - [O9506] 2025-12-31T09:11:10.630Z | Lightwave-Ledstrip | LightwaveOS Architecture and Design Constraints ESP32-S3 LED controller achieving 176 FPS with strict center-origin effect pattern and hardware-specific design rules LightwaveOS is a high-performance LED visualization system built for ESP32-S3 hardware with strict architectural constraints driven by physical hardware…
- `invariant_psram_required` | type=invariant | status=superseded | confidence=high | first_seen=2025-10-15T19:05:16.559000Z | last_seen=2026-02-08T14:59:11.275000Z
  - statement: PSRAM is mandatory for runtime stability and memory budgets.
  - [O28123] 2026-02-08T14:59:11.275Z | Lightwave-Ledstrip | Kuramoto Oscillator Research Documentation Created Comprehensive research documents covering mathematics, computational efficiency, audio mapping, and implementation roadmap for coupled oscillator LED effects.
  - [O28002] 2026-02-08T12:45:13.689Z | Lightwave-Ledstrip | BeatPulseBloomEffect Added and Successfully Compiled New effect compiled successfully increasing RAM usage from 29.3% to 31.6% (7.8 KB increase) and Flash from 30.4% to 30.5% (4.2 KB increase) The primary session added a new effect called BeatPulseBloomEffect and successfully compiled it into the firmware.
  - [O27979] 2026-02-08T12:08:10.154Z | Lightwave-Ledstrip | Firmware successfully uploaded to device - esp32dev_audio_esv11 build with 81.64 second total time Full compilation and upload completed: 1.96MB firmware (29.9% flash), 106KB RAM (32.6%), deployed to ESP32-S3 at MAC b4:3a:45:a5:89:b4.
  - [O27968] 2026-02-08T12:02:27.457Z | Lightwave-Ledstrip | Clock Spine Fix Part 1 Verified: Successful Build Compilation RendererActor esp_timer_get_time() patch compiles successfully with 30.5% flash usage, validating first surgical fix Build verification confirms the first clock spine architecture fix compiles successfully without errors.
- `metric_120fps_budget` | type=success_metric | status=superseded | confidence=high | first_seen=2025-06-23T20:30:27Z | last_seen=2026-02-09T14:35:25.424000Z
  - statement: The renderer targets 120 FPS and strict per-frame execution budgets.
  - [O28339] 2026-02-09T14:35:25.424Z | Lightwave-Ledstrip | Firmware implements clock spine render timing diagnostics with 2-second logging intervals RendererActor.cpp tracks audio frame age, render intervals, and beat clock integration with detailed performance metrics.
  - [O28338] 2026-02-09T14:34:00.302Z | Lightwave-Ledstrip | RendererActor runs at 120 FPS on ESP32 Core 1 with tight frame budget RendererActor implementation shows 8.33ms frame budget with 2-4ms render time and 2ms LED driver overhead.
  - [O28123] 2026-02-08T14:59:11.275Z | Lightwave-Ledstrip | Kuramoto Oscillator Research Documentation Created Comprehensive research documents covering mathematics, computational efficiency, audio mapping, and implementation roadmap for coupled oscillator LED effects.
  - [O28120] 2026-02-08T14:56:40.299Z | Lightwave-Ledstrip | Architected Complete Oscillator Field System Integration Pattern Designed three-layer architecture with PSRAM-backed OscillatorField physics engine, abstract OscillatorFieldEffect base, and concrete effect implementations.